<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload State Manager Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 8px 16px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Upload State Manager Test</h1>
    
    <div class="test-section">
        <h2>Current State</h2>
        <pre id="state-display"></pre>
        <button onclick="updateStateDisplay()">Refresh State</button>
    </div>
    
    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="testCanStartUpload()">Test Can Start Upload</button>
        <button onclick="testStartUpload()">Test Start Upload</button>
        <button onclick="testSetProcessing()">Test Set Processing</button>
        <button onclick="testUpdateProgress()">Test Update Progress</button>
        <button onclick="testCompleteUpload()">Test Complete Upload</button>
        <button onclick="testSetError()">Test Set Error</button>
        <button onclick="testReset()">Test Reset</button>
    </div>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>
    
    <script src="js/upload-state-manager.js"></script>
    <script>
        const stateManager = new UploadStateManager();
        const resultsDiv = document.getElementById('test-results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function updateStateDisplay() {
            const stateInfo = stateManager.getStatusInfo();
            document.getElementById('state-display').textContent = JSON.stringify(stateInfo, null, 2);
        }
        
        function testCanStartUpload() {
            const canStart = stateManager.canStartUpload();
            log(`Can start upload: ${canStart}`, canStart ? 'success' : 'error');
            updateStateDisplay();
        }
        
        function testStartUpload() {
            try {
                const mockFile = new File(['test content'], 'test.csv', { type: 'text/csv' });
                stateManager.startUpload(mockFile);
                log('Start upload: SUCCESS', 'success');
            } catch (error) {
                log(`Start upload: ERROR - ${error.message}`, 'error');
            }
            updateStateDisplay();
        }
        
        function testSetProcessing() {
            try {
                stateManager.setProcessing();
                log('Set processing: SUCCESS', 'success');
            } catch (error) {
                log(`Set processing: ERROR - ${error.message}`, 'error');
            }
            updateStateDisplay();
        }
        
        function testUpdateProgress() {
            try {
                const progress = Math.floor(Math.random() * 100);
                stateManager.updateProgress(progress);
                log(`Update progress to ${progress}%: SUCCESS`, 'success');
            } catch (error) {
                log(`Update progress: ERROR - ${error.message}`, 'error');
            }
            updateStateDisplay();
        }
        
        function testCompleteUpload() {
            try {
                stateManager.completeUpload();
                log('Complete upload: SUCCESS', 'success');
            } catch (error) {
                log(`Complete upload: ERROR - ${error.message}`, 'error');
            }
            updateStateDisplay();
        }
        
        function testSetError() {
            try {
                const error = new Error('Test error message');
                stateManager.setError(error);
                log('Set error: SUCCESS', 'success');
            } catch (error) {
                log(`Set error: ERROR - ${error.message}`, 'error');
            }
            updateStateDisplay();
        }
        
        function testReset() {
            try {
                stateManager.reset();
                log('Reset: SUCCESS', 'success');
            } catch (error) {
                log(`Reset: ERROR - ${error.message}`, 'error');
            }
            updateStateDisplay();
        }
        
        // 初始化显示
        updateStateDisplay();
        log('Upload State Manager Test initialized', 'info');
    </script>
</body>
</html>